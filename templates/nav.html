<div id="side-nav-header" class="side-nav-header d-flex align-items-center justify-content-start">
  <button id="side-nav-toggle-btn" class="side-nav-toggle btn btn-link" aria-label="Toggle navigation" onclick="toggleSideNav()">
    <span class="custom-hamburger">
      <span class="bar1"></span>
      <span class="bar2"></span>
      <span class="bar3"></span>
    </span>
  </button>
  <a class="navbar-brand fw-bold mb-0 ms-2" href="/" id="side-nav-home-link">Home</a>
</div>
<div id="side-nav" class="side-nav open">
  <nav class="side-nav-links mt-3" id="side-nav-links">
    <a class="nav-link nav-panel-link mb-2 {% if request.path == '/' %}active{% endif %}" href="/">Home</a>
    <a class="nav-link nav-panel-link mb-2 {% if 'cards' in request.path %}active{% endif %}" href="/cards">Cards</a>
    <a class="nav-link nav-panel-link mb-2 {% if 'commander' in request.path %}active{% endif %}" href="/commander">Commander Builder</a>
    <a class="nav-link nav-panel-link mb-2 {% if 'visualizations' in request.path %}active{% endif %}" href="/visualizations">Visualizations</a>
    <a class="nav-link nav-panel-link mb-2 {% if 'narrative' in request.path %}active{% endif %}" href="/narrative" style="display: none;">Economy</a>
    <a class="nav-link nav-panel-link mb-2 {% if 'analysis' in request.path %}active{% endif %}" href="/analysis" style="display: none;">Analysis</a>
    
    <hr class="nav-divider my-3">
    
    {% if session.get('user_id') %}
      <!-- Logged in user links -->
      <div class="user-section">
        <small class="text-muted px-3 d-block mb-2">Welcome, {{ session.get('username', 'User') }}!</small>
        <a class="nav-link nav-panel-link mb-2 {% if 'profile' in request.path %}active{% endif %}" href="/profile">
          <i class="fas fa-user me-2"></i>Profile
        </a>
        <a class="nav-link nav-panel-link mb-2" href="/logout">
          <i class="fas fa-sign-out-alt me-2"></i>Sign Out
        </a>
      </div>
    {% else %}
      <!-- Guest user links -->
      <div class="auth-section">
        <small class="text-muted px-3 d-block mb-2">Access AI Features:</small>
        <a class="nav-link nav-panel-link mb-2 {% if 'login' in request.path %}active{% endif %}" href="/login">
          <i class="fas fa-sign-in-alt me-2"></i>Sign In
        </a>
        <a class="nav-link nav-panel-link mb-2 {% if 'register' in request.path %}active{% endif %}" href="/register">
          <i class="fas fa-user-plus me-2"></i>Register
        </a>
      </div>
    {% endif %}
  </nav>
</div>
<style>
.nav-divider {
  border-color: rgba(255, 255, 255, 0.2);
  margin: 1rem 0;
}

.user-section, .auth-section {
  padding: 0.5rem 0;
}

.user-section small, .auth-section small {
  font-size: 0.75rem;
  opacity: 0.8;
  font-weight: 500;
}

.nav-link i {
  width: 16px;
  opacity: 0.7;
}
</style>

<script>
function toggleSideNav() {
  const nav = document.getElementById('side-nav');
  const headerHome = document.getElementById('side-nav-home-link');
  if (nav.classList.contains('open')) {
    nav.classList.remove('open');
    nav.classList.add('closed');
    document.body.classList.remove('side-nav-open');
    document.body.classList.add('side-nav-closed');
    if (headerHome) headerHome.style.display = '';
  } else {
    nav.classList.remove('closed');
    nav.classList.add('open');
    document.body.classList.remove('side-nav-closed');
    document.body.classList.add('side-nav-open');
    if (headerHome) headerHome.style.display = 'none';
  }
}
// Start with menu closed and Home visible in header
window.addEventListener('DOMContentLoaded', function() {
  document.getElementById('side-nav').classList.add('closed');
  document.body.classList.add('side-nav-closed');
  // Show Home in header when menu is closed
  const headerHome = document.getElementById('side-nav-home-link');
  if (headerHome) headerHome.style.display = '';
});
</script>
